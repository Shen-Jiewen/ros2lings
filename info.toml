format_version = 1

welcome_message = """
欢迎来到 ROS2lings！

你将通过修复一系列"坏掉的" ROS2 程序来学习 ROS2 核心概念。
每个练习都是一个独立的 ROS2 包，包含 TODO 标记指引你修改。

快捷键: q=退出, h=提示, l=当前练习, n=跳过
"""

final_message = """
恭喜！你已经完成了 ROS2lings 的所有练习！

你现在掌握了:
- ROS2 节点、话题、发布/订阅
- 服务、Action 客户端/服务器
- 自定义消息、QoS、组件化节点
- Launch 文件、参数系统、YAML 配置
- TF2 坐标变换、帧链、多机器人 TF
- URDF 机器人建模、Xacro 参数化、TF 集成

继续探索 ROS2 的更深层次吧！
"""

# ── Module 01: Nodes & Topics (15 exercises) ──

[[exercises]]
name = "01_hello_node"
dir = "01_nodes/01_hello_node"
module = "Nodes & Topics"
mode = "fix"
language = "cpp"
difficulty = 1
estimated_minutes = 5
hint_count = 3
test = true
hint = "rclcpp::init() 需要 argc 和 argv 两个参数。节点要用 std::make_shared 创建。"

[[exercises]]
name = "02_first_publisher"
dir = "01_nodes/02_first_publisher"
module = "Nodes & Topics"
mode = "fix"
language = "cpp"
difficulty = 1
estimated_minutes = 10
hint_count = 3
depends_on = ["01_hello_node"]
test = true
hint = "create_publisher 需要话题名和 QoS 深度。Timer 回调用 lambda 或 std::bind。"

[[exercises]]
name = "03_first_subscriber"
dir = "01_nodes/03_first_subscriber"
module = "Nodes & Topics"
mode = "fix"
language = "cpp"
difficulty = 1
estimated_minutes = 10
hint_count = 3
depends_on = ["02_first_publisher"]
test = true
hint = "create_subscription 需要话题名、QoS 和回调函数。回调参数类型是消息的 SharedPtr。"

[[exercises]]
name = "04_pubsub_connect"
dir = "01_nodes/04_pubsub_connect"
module = "Nodes & Topics"
mode = "implement"
language = "cpp"
difficulty = 2
estimated_minutes = 15
hint_count = 3
depends_on = ["03_first_subscriber"]
test = true
hint = "你需要创建一个发布者节点和一个订阅者节点，让它们通过同一个话题通信。"

[[exercises]]
name = "05_custom_message"
dir = "01_nodes/05_custom_message"
module = "Nodes & Topics"
mode = "implement"
language = "cpp"
difficulty = 2
estimated_minutes = 15
hint_count = 3
depends_on = ["04_pubsub_connect"]
test = true
hint = "在 msg/ 目录下创建 .msg 文件，在 CMakeLists.txt 中用 rosidl_generate_interfaces 生成。"

[[exercises]]
name = "06_multi_topic"
dir = "01_nodes/06_multi_topic"
module = "Nodes & Topics"
mode = "implement"
language = "cpp"
difficulty = 2
estimated_minutes = 20
hint_count = 3
depends_on = ["05_custom_message"]
test = true
hint = "一个节点可以同时有多个 publisher 和 subscriber，分别订阅不同的话题。"

[[exercises]]
name = "07_topic_introspection"
dir = "01_nodes/07_topic_introspection"
module = "Nodes & Topics"
mode = "explore"
language = "cpp"
difficulty = 1
estimated_minutes = 10
hint_count = 2
depends_on = ["04_pubsub_connect"]
test = true
hint = "使用 ros2 topic list、ros2 topic info、ros2 topic echo 来检查话题。"

[[exercises]]
name = "08_node_lifecycle_basics"
dir = "01_nodes/08_node_lifecycle_basics"
module = "Nodes & Topics"
mode = "explore"
language = "cpp"
difficulty = 2
estimated_minutes = 15
hint_count = 2
depends_on = ["01_hello_node"]
test = true
hint = "rclcpp::Node 构造函数内部会创建 rcl_node_t，注册到 context，分配回调组。"

[[exercises]]
name = "09_hello_node_py"
dir = "01_nodes/09_hello_node_py"
module = "Nodes & Topics"
mode = "fix"
language = "python"
difficulty = 1
estimated_minutes = 5
hint_count = 3
test = true
hint = "rclpy.init() 初始化，Node('name') 创建节点，rclpy.spin(node) 运行。"

[[exercises]]
name = "10_publisher_py"
dir = "01_nodes/10_publisher_py"
module = "Nodes & Topics"
mode = "fix"
language = "python"
difficulty = 1
estimated_minutes = 10
hint_count = 3
depends_on = ["09_hello_node_py"]
test = true
hint = "self.create_publisher(String, 'topic', 10) 创建发布者。Timer 用 self.create_timer。"

[[exercises]]
name = "11_subscriber_py"
dir = "01_nodes/11_subscriber_py"
module = "Nodes & Topics"
mode = "fix"
language = "python"
difficulty = 1
estimated_minutes = 10
hint_count = 3
depends_on = ["10_publisher_py"]
test = true
hint = "self.create_subscription(String, 'topic', callback, 10) 创建订阅者。"

[[exercises]]
name = "12_qos_mismatch"
dir = "01_nodes/12_qos_mismatch"
module = "Nodes & Topics"
mode = "debug"
language = "cpp"
difficulty = 2
estimated_minutes = 15
hint_count = 3
depends_on = ["03_first_subscriber"]
test = true
hint = "Publisher 和 Subscriber 的 QoS 策略必须兼容。检查 reliability 和 durability 设置。"

[[exercises]]
name = "13_component_node"
dir = "01_nodes/13_component_node"
module = "Nodes & Topics"
mode = "implement"
language = "cpp"
difficulty = 3
estimated_minutes = 20
hint_count = 3
depends_on = ["04_pubsub_connect"]
test = true
hint = "组件节点继承 rclcpp::Node，在构造函数中初始化，用 RCLCPP_COMPONENTS_REGISTER_NODE 注册。"

[[exercises]]
name = "14_namespace_remap"
dir = "01_nodes/14_namespace_remap"
module = "Nodes & Topics"
mode = "fix"
language = "cpp"
difficulty = 2
estimated_minutes = 10
hint_count = 3
depends_on = ["04_pubsub_connect"]
test = true
hint = "NodeOptions 可以设置命名空间。话题重映射通过 remap 参数实现。"

[[exercises]]
name = "15_multi_node_process"
dir = "01_nodes/15_multi_node_process"
module = "Nodes & Topics"
mode = "implement"
language = "cpp"
difficulty = 2
estimated_minutes = 15
hint_count = 3
depends_on = ["04_pubsub_connect"]
test = true
hint = "多个节点可以共享一个 Executor。用 executor.add_node() 添加，executor.spin() 运行。"

# ── Module 02: Services & Actions (12 exercises) ──

[[exercises]]
name = "16_first_service"
dir = "02_services/01_first_service"
module = "Services & Actions"
mode = "fix"
language = "cpp"
difficulty = 1
estimated_minutes = 10
hint_count = 3
test = true
hint = "create_service 需要服务名和回调。回调签名: (request, response) -> void。"

[[exercises]]
name = "17_service_client"
dir = "02_services/02_service_client"
module = "Services & Actions"
mode = "fix"
language = "cpp"
difficulty = 2
estimated_minutes = 15
hint_count = 3
depends_on = ["16_first_service"]
test = true
hint = "异步调用: client->async_send_request(request)。用 rclcpp::spin_until_future_complete 等待。"

[[exercises]]
name = "18_service_pair"
dir = "02_services/03_service_pair"
module = "Services & Actions"
mode = "implement"
language = "cpp"
difficulty = 2
estimated_minutes = 20
hint_count = 3
depends_on = ["17_service_client"]
test = true
hint = "实现一个 AddTwoInts 服务: server 接收两个整数并返回它们的和。"

[[exercises]]
name = "19_custom_srv"
dir = "02_services/04_custom_srv"
module = "Services & Actions"
mode = "implement"
language = "cpp"
difficulty = 2
estimated_minutes = 15
hint_count = 3
depends_on = ["18_service_pair"]
test = true
hint = "在 srv/ 目录下创建 .srv 文件。格式: request 字段 --- response 字段。"

[[exercises]]
name = "20_service_py"
dir = "02_services/05_service_py"
module = "Services & Actions"
mode = "fix"
language = "python"
difficulty = 1
estimated_minutes = 10
hint_count = 3
test = true
hint = "self.create_service(AddTwoInts, 'service_name', callback)。回调: (request, response) -> response。"

[[exercises]]
name = "21_first_action_server"
dir = "02_services/06_first_action_server"
module = "Services & Actions"
mode = "fix"
language = "cpp"
difficulty = 3
estimated_minutes = 20
hint_count = 3
depends_on = ["16_first_service"]
test = true
hint = "ActionServer 需要 handle_goal、handle_cancel、handle_accepted 三个回调。"

[[exercises]]
name = "22_action_client"
dir = "02_services/07_action_client"
module = "Services & Actions"
mode = "fix"
language = "cpp"
difficulty = 3
estimated_minutes = 20
hint_count = 3
depends_on = ["21_first_action_server"]
test = true
hint = "async_send_goal 发送目标。通过 GoalHandleFibonacci::SharedPtr 获取反馈和结果。"

[[exercises]]
name = "23_action_complete"
dir = "02_services/08_action_complete"
module = "Services & Actions"
mode = "implement"
language = "cpp"
difficulty = 3
estimated_minutes = 25
hint_count = 3
depends_on = ["22_action_client"]
test = true
hint = "实现完整的 Fibonacci Action: server 计算并发送中间反馈，client 可以取消目标。"

[[exercises]]
name = "24_custom_action"
dir = "02_services/09_custom_action"
module = "Services & Actions"
mode = "implement"
language = "cpp"
difficulty = 2
estimated_minutes = 15
hint_count = 3
depends_on = ["23_action_complete"]
test = true
hint = "在 action/ 目录下创建 .action 文件。格式: goal --- result --- feedback。"

[[exercises]]
name = "25_action_py"
dir = "02_services/10_action_py"
module = "Services & Actions"
mode = "fix"
language = "python"
difficulty = 2
estimated_minutes = 15
hint_count = 3
test = true
hint = "ActionServer(self, Fibonacci, 'fibonacci', execute_callback=self.execute_callback)。"

[[exercises]]
name = "26_service_introspection"
dir = "02_services/11_service_introspection"
module = "Services & Actions"
mode = "explore"
language = "cpp"
difficulty = 2
estimated_minutes = 10
hint_count = 2
depends_on = ["18_service_pair"]
test = true
hint = "使用 ros2 service list、ros2 service type、ros2 service call 检查服务。"

[[exercises]]
name = "27_action_state_machine"
dir = "02_services/12_action_state_machine"
module = "Services & Actions"
mode = "debug"
language = "cpp"
difficulty = 3
estimated_minutes = 20
hint_count = 3
depends_on = ["23_action_complete"]
test = true
hint = "Action 有严格的状态转换: ACCEPTED → EXECUTING → SUCCEEDED/ABORTED/CANCELED。"

# ── Module 03: Launch & Parameters (10 exercises) ──

[[exercises]]
name = "28_first_launch"
dir = "03_launch/01_first_launch"
module = "Launch & Parameters"
mode = "fix"
language = "python"
difficulty = 1
estimated_minutes = 10
hint_count = 3
test = true
hint = "launch 文件必须返回 LaunchDescription，Node action 需要正确的 package 和 executable。"

[[exercises]]
name = "29_multi_node_launch"
dir = "03_launch/02_multi_node_launch"
module = "Launch & Parameters"
mode = "fix"
language = "python"
difficulty = 1
estimated_minutes = 10
hint_count = 3
depends_on = ["28_first_launch"]
test = true
hint = "每个节点需要唯一的 name，确保所有节点都添加到 LaunchDescription 中。"

[[exercises]]
name = "30_launch_arguments"
dir = "03_launch/03_launch_arguments"
module = "Launch & Parameters"
mode = "implement"
language = "python"
difficulty = 2
estimated_minutes = 15
hint_count = 3
depends_on = ["29_multi_node_launch"]
test = true
hint = "用 DeclareLaunchArgument 声明参数，用 LaunchConfiguration 获取参数值。"

[[exercises]]
name = "31_node_parameters"
dir = "03_launch/04_node_parameters"
module = "Launch & Parameters"
mode = "fix"
language = "cpp"
difficulty = 2
estimated_minutes = 15
hint_count = 3
test = true
hint = "declare_parameter 的默认值类型必须与 get_parameter 的 as_xxx() 类型匹配。"

[[exercises]]
name = "32_parameter_callback"
dir = "03_launch/05_parameter_callback"
module = "Launch & Parameters"
mode = "fix"
language = "cpp"
difficulty = 2
estimated_minutes = 15
hint_count = 3
depends_on = ["31_node_parameters"]
test = true
hint = "用 add_on_set_parameters_callback 注册回调，返回 SetParametersResult。"

[[exercises]]
name = "33_yaml_config"
dir = "03_launch/06_yaml_config"
module = "Launch & Parameters"
mode = "implement"
language = "python"
difficulty = 2
estimated_minutes = 15
hint_count = 3
depends_on = ["30_launch_arguments"]
test = true
hint = "在 launch 文件中用 parameters=[yaml_file_path] 传入 YAML 配置文件路径。"

[[exercises]]
name = "34_conditional_launch"
dir = "03_launch/07_conditional_launch"
module = "Launch & Parameters"
mode = "implement"
language = "python"
difficulty = 3
estimated_minutes = 20
hint_count = 3
depends_on = ["30_launch_arguments"]
test = true
hint = "IfCondition 接受 LaunchConfiguration，UnlessCondition 是它的反面。"

[[exercises]]
name = "35_parameter_py"
dir = "03_launch/08_parameter_py"
module = "Launch & Parameters"
mode = "fix"
language = "python"
difficulty = 2
estimated_minutes = 10
hint_count = 3
test = true
hint = "必须先 declare_parameter 再 get_parameter，默认值类型要匹配。"

[[exercises]]
name = "36_launch_composition"
dir = "03_launch/09_launch_composition"
module = "Launch & Parameters"
mode = "implement"
language = "python"
difficulty = 3
estimated_minutes = 20
hint_count = 3
depends_on = ["29_multi_node_launch"]
test = true
hint = "ComposableNodeContainer 管理组件，ComposableNode 的 plugin 名必须与 REGISTER_NODE 宏一致。"

[[exercises]]
name = "37_launch_events"
dir = "03_launch/10_launch_events"
module = "Launch & Parameters"
mode = "explore"
language = "python"
difficulty = 3
estimated_minutes = 15
hint_count = 3
depends_on = ["29_multi_node_launch"]
test = true
hint = "OnProcessExit 在进程退出后触发，RegisterEventHandler 注册事件处理器。"

# ── Module 04: TF2 Transforms (10 exercises) ──

[[exercises]]
name = "38_static_broadcaster"
dir = "04_tf2/01_static_broadcaster"
module = "TF2 Transforms"
mode = "fix"
language = "cpp"
difficulty = 1
estimated_minutes = 10
hint_count = 3
test = true
hint = "StaticTransformBroadcaster 需要正确的头文件。frame_id 是父帧，child_frame_id 是子帧。"

[[exercises]]
name = "39_dynamic_broadcaster"
dir = "04_tf2/02_dynamic_broadcaster"
module = "TF2 Transforms"
mode = "fix"
language = "cpp"
difficulty = 2
estimated_minutes = 15
hint_count = 3
depends_on = ["38_static_broadcaster"]
test = true
hint = "动态变换用 TransformBroadcaster（非 Static），时间戳必须用 this->now() 更新。"

[[exercises]]
name = "40_tf_listener"
dir = "04_tf2/03_tf_listener"
module = "TF2 Transforms"
mode = "fix"
language = "cpp"
difficulty = 2
estimated_minutes = 15
hint_count = 3
depends_on = ["39_dynamic_broadcaster"]
test = true
hint = "Buffer 需要时钟参数。lookupTransform(target, source, time) 注意参数顺序。"

[[exercises]]
name = "41_frame_chain"
dir = "04_tf2/04_frame_chain"
module = "TF2 Transforms"
mode = "implement"
language = "cpp"
difficulty = 2
estimated_minutes = 20
hint_count = 3
depends_on = ["38_static_broadcaster"]
test = true
hint = "发布多个静态变换构建帧链：map → odom → base_link → sensor_link。"

[[exercises]]
name = "42_tf_time_travel"
dir = "04_tf2/05_tf_time_travel"
module = "TF2 Transforms"
mode = "debug"
language = "cpp"
difficulty = 3
estimated_minutes = 20
hint_count = 3
depends_on = ["40_tf_listener"]
test = true
hint = "用 tf2::TimePointZero 获取最新变换，timeout 不能为 0，捕获 tf2::TransformException。"

[[exercises]]
name = "43_tf_broadcaster_py"
dir = "04_tf2/06_tf_broadcaster_py"
module = "TF2 Transforms"
mode = "fix"
language = "python"
difficulty = 1
estimated_minutes = 10
hint_count = 3
test = true
hint = "Python 中用 TransformBroadcaster（非 Static），时间戳用 self.get_clock().now().to_msg()。"

[[exercises]]
name = "44_tf_listener_py"
dir = "04_tf2/07_tf_listener_py"
module = "TF2 Transforms"
mode = "fix"
language = "python"
difficulty = 2
estimated_minutes = 15
hint_count = 3
depends_on = ["43_tf_broadcaster_py"]
test = true
hint = "TransformListener 需要 buffer 和 node 参数。lookup_transform 注意帧参数顺序。"

[[exercises]]
name = "45_coordinate_transform"
dir = "04_tf2/08_coordinate_transform"
module = "TF2 Transforms"
mode = "implement"
language = "cpp"
difficulty = 3
estimated_minutes = 25
hint_count = 3
depends_on = ["40_tf_listener"]
test = true
hint = "tf2::doTransform 将点从一个帧变换到另一个帧，需要先 lookupTransform 获取变换。"

[[exercises]]
name = "46_tf_debug"
dir = "04_tf2/09_tf_debug"
module = "TF2 Transforms"
mode = "explore"
language = "python"
difficulty = 2
estimated_minutes = 10
hint_count = 3
depends_on = ["40_tf_listener"]
test = true
hint = "view_frames 生成 TF 树图，静态变换在 /tf_static，动态变换在 /tf。"

[[exercises]]
name = "47_multi_robot_tf"
dir = "04_tf2/10_multi_robot_tf"
module = "TF2 Transforms"
mode = "implement"
language = "cpp"
difficulty = 3
estimated_minutes = 25
hint_count = 3
depends_on = ["41_frame_chain"]
test = true
hint = "用 robot1/、robot2/ 前缀隔离不同机器人的 TF 帧，共享 world 根帧。"

# ── Module 05: URDF & Robot Modeling (8 exercises) ──

[[exercises]]
name = "48_first_urdf"
dir = "05_urdf/01_first_urdf"
module = "URDF & Robot Modeling"
mode = "fix"
language = "cpp"
difficulty = 1
estimated_minutes = 10
hint_count = 3
test = true
hint = "robot 标签需要 name 属性，link 需要正确的 name，box size 需要三个值。"

[[exercises]]
name = "49_links_and_joints"
dir = "05_urdf/02_links_and_joints"
module = "URDF & Robot Modeling"
mode = "fix"
language = "cpp"
difficulty = 2
estimated_minutes = 15
hint_count = 3
depends_on = ["48_first_urdf"]
test = true
hint = "joint type 拼写要正确，parent/child link 名称要匹配，revolute joint 需要 axis 和 limit。"

[[exercises]]
name = "50_visual_geometry"
dir = "05_urdf/03_visual_geometry"
module = "URDF & Robot Modeling"
mode = "implement"
language = "cpp"
difficulty = 2
estimated_minutes = 15
hint_count = 3
depends_on = ["49_links_and_joints"]
test = true
hint = "box、cylinder、sphere 是三种基本几何体，material 元素设置颜色。"

[[exercises]]
name = "51_collision_inertia"
dir = "05_urdf/04_collision_inertia"
module = "URDF & Robot Modeling"
mode = "implement"
language = "cpp"
difficulty = 2
estimated_minutes = 15
hint_count = 3
depends_on = ["50_visual_geometry"]
test = true
hint = "collision 几何体通常与 visual 相同，inertial 需要 mass、origin、inertia 矩阵。"

[[exercises]]
name = "52_xacro_basics"
dir = "05_urdf/05_xacro_basics"
module = "URDF & Robot Modeling"
mode = "fix"
language = "cpp"
difficulty = 2
estimated_minutes = 15
hint_count = 3
depends_on = ["49_links_and_joints"]
test = true
hint = "Xacro 命名空间 URL 要完整，属性引用用 ${}，宏参数名要与定义一致。"

[[exercises]]
name = "53_xacro_params"
dir = "05_urdf/06_xacro_params"
module = "URDF & Robot Modeling"
mode = "implement"
language = "cpp"
difficulty = 3
estimated_minutes = 20
hint_count = 3
depends_on = ["52_xacro_basics"]
test = true
hint = "用 xacro:property 定义属性，xacro:macro 定义可复用的宏，然后调用宏构建机械臂。"

[[exercises]]
name = "54_robot_state_pub"
dir = "05_urdf/07_robot_state_pub"
module = "URDF & Robot Modeling"
mode = "implement"
language = "python"
difficulty = 2
estimated_minutes = 15
hint_count = 3
depends_on = ["48_first_urdf"]
test = true
hint = "用 open() 读取 URDF 文件，通过 parameters=[{'robot_description': content}] 传给节点。"

[[exercises]]
name = "55_urdf_tf_integration"
dir = "05_urdf/08_urdf_tf_integration"
module = "URDF & Robot Modeling"
mode = "explore"
language = "python"
difficulty = 3
estimated_minutes = 15
hint_count = 3
depends_on = ["54_robot_state_pub"]
test = true
hint = "robot_state_publisher 读取 robot_description 参数，fixed joint 发布到 /tf_static。"
